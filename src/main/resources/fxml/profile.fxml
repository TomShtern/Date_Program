<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Circle?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane fx:id="rootPane" prefHeight="700.0" prefWidth="700.0"
    xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
    fx:controller="datingapp.ui.controller.ProfileController">
  <!-- Top Header -->
  <top>
    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="header-bar">
      <Button onAction="#handleBack" styleClass="button-transparent">
        <graphic>
          <FontIcon iconLiteral="mdi2c-chevron-left" iconSize="28" iconColor="white"/>
        </graphic>
        <tooltip><Tooltip text="Go back to Dashboard"/></tooltip>
      </Button>
      <Label styleClass="subheading" text="Edit Profile"/>
      <Region HBox.hgrow="ALWAYS"/>
      <!-- Profile Completion Badge -->
      <VBox alignment="CENTER" spacing="2">
        <Label fx:id="completionLabel" styleClass="notification-badge profile-completion-percent" text="20%"/>
        <Label styleClass="profile-completion-text" text="complete"/>
      </VBox>
    </HBox>
  </top>

  <!-- Center Content - Scrollable Profile Form -->
  <center>
    <ScrollPane fitToWidth="true" styleClass="transparent-scroll">
      <VBox spacing="24" styleClass="profile-hero">
        <padding>
          <Insets bottom="40" left="50" right="50" top="20"/>
        </padding>
        <!-- Avatar Section - Enhanced with glow ring -->
        <VBox alignment="CENTER" spacing="16">
          <StackPane styleClass="profile-avatar-container">
            <!-- Outer glow ring -->
            <StackPane styleClass="profile-glow-ring"/>
            <!-- Inner avatar circle with photo or placeholder -->
            <StackPane fx:id="avatarInner" styleClass="profile-avatar-inner">
              <!-- Profile photo ImageView (hidden by default) -->
              <ImageView fx:id="profileImageView" fitWidth="100" fitHeight="100" preserveRatio="true" visible="false">
                <clip>
                  <Circle radius="50" centerX="50" centerY="50"/>
                </clip>
              </ImageView>
              <!-- Placeholder icon (shown when no photo) -->
              <FontIcon fx:id="avatarPlaceholderIcon" iconLiteral="mdi2a-account" iconSize="56" iconColor="#94a3b8"/>
            </StackPane>
            <!-- Camera button overlay - clickable -->
            <VBox alignment="BOTTOM_RIGHT">
              <padding>
                <Insets right="5" bottom="5"/>
              </padding>
              <Button fx:id="cameraButton" onAction="#handleUploadPhoto" styleClass="profile-camera-btn">
                <graphic>
                  <FontIcon iconLiteral="mdi2c-camera" iconSize="18" iconColor="white"/>
                </graphic>
                <tooltip><Tooltip text="Upload a profile photo"/></tooltip>
              </Button>
            </VBox>
          </StackPane>
          <Label fx:id="nameLabel" styleClass="profile-name" text="User Name"/>
        </VBox>
        <!-- Decorative separator -->
        <Region styleClass="profile-separator" prefHeight="1"/>
        <!-- About Me Section -->
        <VBox styleClass="section-glass-card" spacing="12">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2a-account-edit" iconSize="20" iconColor="#a78bfa"/>
            </StackPane>
            <Label styleClass="section-title" text="About Me"/>
            <Region HBox.hgrow="ALWAYS"/>
            <!-- Character counter -->
            <Label fx:id="charCountLabel" styleClass="char-counter" text="0/500"/>
          </HBox>
          <TextArea fx:id="bioArea" prefHeight="100" promptText="Tell others about yourself..."
                                                      wrapText="true" styleClass="bio-textarea"/>
        </VBox>
        <!-- Location Section -->
        <VBox styleClass="section-glass-card" spacing="12">
          <HBox styleClass="section-header">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2m-map-marker" iconSize="20" iconColor="#f472b6"/>
            </StackPane>
            <Label styleClass="section-title" text="Location"/>
          </HBox>
          <HBox spacing="12" alignment="CENTER_LEFT">
            <FontIcon iconLiteral="mdi2m-map-marker-outline" iconSize="20" iconColor="#64748b"/>
            <TextField fx:id="locationField" promptText="e.g. 40.7128, -74.0060"
                                                                HBox.hgrow="ALWAYS"/>
          </HBox>
        </VBox>
        <!-- Interests Section -->
        <VBox styleClass="section-glass-card" spacing="12">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2h-heart-multiple" iconSize="20" iconColor="#fb923c"/>
            </StackPane>
            <Label styleClass="section-title" text="Interests"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label styleClass="text-secondary profile-readonly-hint" text="Read-only"/>
          </HBox>
          <!-- Interest chips display -->
          <FlowPane fx:id="interestsFlow" styleClass="interests-container" hgap="10" vgap="10">
            <Label styleClass="interest-chip" text="No interests set"/>
          </FlowPane>
          <!-- Hidden field for binding -->
          <TextField fx:id="interestsField" visible="false" managed="false"/>
          <HBox alignment="CENTER_LEFT" spacing="8">
            <FontIcon iconLiteral="mdi2i-information-outline" iconSize="14" iconColor="#64748b"/>
            <Label styleClass="text-secondary profile-edit-hint" text="Edit interests in Settings"/>
          </HBox>
        </VBox>
        <!-- Spacer to ensure scroll content doesn't overlap with sticky footer -->
        <Region prefHeight="80"/>
      </VBox>
    </ScrollPane>
  </center>

  <!-- Sticky Action Footer -->
  <bottom>
    <VBox styleClass="sticky-footer" spacing="12">
      <Button onAction="#handleSave" text="Save Changes" styleClass="cta-primary-full">
        <graphic>
          <FontIcon iconLiteral="mdi2c-content-save-outline" iconSize="20" iconColor="white"/>
        </graphic>
      </Button>
      <Button onAction="#handleCancel" text="Cancel" styleClass="button-ghost-full"/>
    </VBox>
  </bottom>
</BorderPane>
