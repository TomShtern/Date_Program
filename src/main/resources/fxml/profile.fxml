<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Circle?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane fx:id="rootPane" prefHeight="700.0" prefWidth="700.0"
    xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
    fx:controller="datingapp.ui.controller.ProfileController">
  <!-- Top Header -->
  <top>
    <HBox alignment="CENTER_LEFT" spacing="16" styleClass="header-bar">
      <Button onAction="#handleBack" styleClass="button-transparent">
        <graphic>
          <FontIcon iconLiteral="mdi2c-chevron-left" iconSize="28" iconColor="white"/>
        </graphic>
        <tooltip><Tooltip text="Go back to Dashboard"/></tooltip>
      </Button>
      <Label styleClass="subheading" text="Edit Profile"/>
      <Region HBox.hgrow="ALWAYS"/>
      <!-- Profile Completion Badge -->
      <VBox alignment="CENTER" spacing="2">
        <Label fx:id="completionLabel" styleClass="notification-badge profile-completion-percent" text="20%"/>
        <Label styleClass="profile-completion-text" text="complete"/>
        <Label fx:id="completionDetailsLabel" maxWidth="180" styleClass="text-secondary" text="Missing: --"
               wrapText="true"/>
      </VBox>
    </HBox>
  </top>

  <!-- Center Content - Scrollable Profile Form -->
  <center>
    <ScrollPane fitToWidth="true" styleClass="transparent-scroll">
      <VBox spacing="24" styleClass="profile-hero">
        <padding>
          <Insets bottom="40" left="50" right="50" top="20"/>
        </padding>
        <!-- Avatar Section - Enhanced with glow ring -->
        <VBox alignment="CENTER" spacing="16">
          <StackPane styleClass="profile-avatar-container">
            <!-- Outer glow ring -->
            <StackPane styleClass="profile-glow-ring"/>
            <!-- Inner avatar circle with photo or placeholder -->
            <StackPane fx:id="avatarInner" styleClass="profile-avatar-inner">
              <!-- Profile photo ImageView (hidden by default) -->
              <ImageView fx:id="profileImageView" fitWidth="100" fitHeight="100" preserveRatio="true" visible="false">
                <clip>
                  <Circle radius="50" centerX="50" centerY="50"/>
                </clip>
              </ImageView>
              <!-- Placeholder icon (shown when no photo) -->
              <FontIcon fx:id="avatarPlaceholderIcon" iconLiteral="mdi2a-account" iconSize="56" iconColor="#94a3b8"/>
            </StackPane>
            <!-- Camera button overlay - clickable -->
            <VBox alignment="BOTTOM_RIGHT">
              <padding>
                <Insets right="5" bottom="5"/>
              </padding>
              <Button fx:id="cameraButton" onAction="#handleUploadPhoto" styleClass="profile-camera-btn">
                <graphic>
                  <FontIcon iconLiteral="mdi2c-camera" iconSize="18" iconColor="white"/>
                </graphic>
                <tooltip><Tooltip text="Upload a profile photo"/></tooltip>
              </Button>
            </VBox>
          </StackPane>
          <Label fx:id="nameLabel" styleClass="profile-name" text="User Name"/>
        </VBox>
        <!-- Decorative separator -->
        <Region styleClass="profile-separator" prefHeight="1"/>
        <!-- About Me Section -->
        <VBox styleClass="section-glass-card" spacing="12">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2a-account-edit" iconSize="20" iconColor="#a78bfa"/>
            </StackPane>
            <Label styleClass="section-title" text="About Me"/>
            <Region HBox.hgrow="ALWAYS"/>
            <!-- Character counter -->
            <Label fx:id="charCountLabel" styleClass="char-counter" text="0/500"/>
          </HBox>
          <TextArea fx:id="bioArea" prefHeight="100" promptText="Tell others about yourself..."
                                                      wrapText="true" styleClass="bio-textarea"/>
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Birth date:" prefWidth="120"/>
            <DatePicker fx:id="birthDatePicker" promptText="YYYY-MM-DD" prefWidth="180"/>
          </HBox>
        </VBox>
        <!-- Location Section -->
        <VBox styleClass="section-glass-card" spacing="12">
          <HBox styleClass="section-header">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2m-map-marker" iconSize="20" iconColor="#f472b6"/>
            </StackPane>
            <Label styleClass="section-title" text="Location"/>
          </HBox>
          <HBox spacing="12" alignment="CENTER_LEFT">
            <FontIcon iconLiteral="mdi2m-map-marker-outline" iconSize="20" iconColor="#64748b"/>
            <TextField fx:id="locationField" promptText="e.g. 40.7128, -74.0060"
                                                                HBox.hgrow="ALWAYS"/>
          </HBox>
        </VBox>

        <!-- Gender &amp; Preferences Section - CRITICAL for matching -->
        <VBox styleClass="section-glass-card" spacing="16">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2g-gender-male-female" iconSize="20" iconColor="#c084fc"/>
            </StackPane>
            <Label styleClass="section-title" text="Gender &amp; Preferences"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label styleClass="text-secondary" text="Required for matching"/>
          </HBox>

          <!-- Gender -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="I am:" prefWidth="120"/>
            <ComboBox fx:id="genderCombo" promptText="Select your gender..." prefWidth="180"/>
          </HBox>

          <!-- Interested In (multi-select) -->
          <VBox spacing="8">
            <HBox spacing="12" alignment="CENTER_LEFT">
              <Label styleClass="field-label" text="Interested in:"/>
              <Label fx:id="interestedInLabel" styleClass="text-secondary" text="Select at least one"/>
            </HBox>
            <FlowPane fx:id="interestedInFlow" hgap="12" vgap="8">
              <!-- Populated programmatically with toggle buttons -->
            </FlowPane>
          </VBox>
        </VBox>

        <!-- Interests Section - Editable -->
        <VBox styleClass="section-glass-card" spacing="12">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2h-heart-multiple" iconSize="20" iconColor="#fb923c"/>
            </StackPane>
            <Label styleClass="section-title" text="Interests"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="interestCountLabel" styleClass="text-secondary" text="0/10 selected"/>
          </HBox>
          <!-- Interest chips display - clickable -->
          <FlowPane fx:id="interestsFlow" styleClass="interests-container" hgap="10" vgap="10">
            <Label styleClass="interest-chip" text="Click to add interests..."/>
          </FlowPane>
          <!-- Hidden field for binding -->
          <TextField fx:id="interestsField" visible="false" managed="false"/>
          <Button onAction="#handleEditInterests" text="Select Interests" styleClass="button-secondary-small">
            <graphic>
              <FontIcon iconLiteral="mdi2p-plus" iconSize="16" iconColor="white"/>
            </graphic>
          </Button>
        </VBox>

        <!-- Lifestyle Section -->
        <VBox styleClass="section-glass-card" spacing="16">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2a-account-heart" iconSize="20" iconColor="#34d399"/>
            </StackPane>
            <Label styleClass="section-title" text="Lifestyle"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label styleClass="text-secondary" text="Helps find compatible matches"/>
          </HBox>

          <!-- Height -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Height (cm):" prefWidth="120"/>
            <TextField fx:id="heightField" promptText="e.g. 175" prefWidth="100"/>
          </HBox>

          <!-- Smoking -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Smoking:" prefWidth="120"/>
            <ComboBox fx:id="smokingCombo" promptText="Select..." prefWidth="180"/>
          </HBox>

          <!-- Drinking -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Drinking:" prefWidth="120"/>
            <ComboBox fx:id="drinkingCombo" promptText="Select..." prefWidth="180"/>
          </HBox>

          <!-- Wants Kids -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Kids:" prefWidth="120"/>
            <ComboBox fx:id="wantsKidsCombo" promptText="Select..." prefWidth="180"/>
          </HBox>

          <!-- Looking For -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Looking for:" prefWidth="120"/>
            <ComboBox fx:id="lookingForCombo" promptText="Select..." prefWidth="180"/>
          </HBox>
        </VBox>

        <!-- Search Preferences Section -->
        <VBox styleClass="section-glass-card" spacing="16">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2t-tune" iconSize="20" iconColor="#60a5fa"/>
            </StackPane>
            <Label styleClass="section-title" text="Search Preferences"/>
          </HBox>

          <!-- Age Range -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Age range:" prefWidth="120"/>
            <TextField fx:id="minAgeField" promptText="18" prefWidth="60"/>
            <Label text="to"/>
            <TextField fx:id="maxAgeField" promptText="99" prefWidth="60"/>
            <Label styleClass="text-secondary" text="years"/>
          </HBox>

          <!-- Max Distance -->
          <HBox spacing="12" alignment="CENTER_LEFT">
            <Label styleClass="field-label" text="Max distance:" prefWidth="120"/>
            <TextField fx:id="maxDistanceField" promptText="50" prefWidth="80"/>
            <Label styleClass="text-secondary" text="km"/>
          </HBox>
        </VBox>

        <!-- Dealbreakers Section (Optional) -->
        <VBox styleClass="section-glass-card" spacing="16">
          <HBox styleClass="section-header" alignment="CENTER_LEFT">
            <StackPane styleClass="section-icon-container">
              <FontIcon iconLiteral="mdi2s-shield-check" iconSize="20" iconColor="#f87171"/>
            </StackPane>
            <Label styleClass="section-title" text="Dealbreakers"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="dealbreakersStatusLabel" styleClass="text-secondary" text="None set"/>
          </HBox>
          <Label styleClass="text-secondary" text="Set hard filters to exclude certain profiles. Optional."/>
          <Button fx:id="editDealbreakersBtn" onAction="#handleEditDealbreakers" text="Configure Dealbreakers" styleClass="button-secondary-small">
            <graphic>
              <FontIcon iconLiteral="mdi2p-pencil" iconSize="16" iconColor="white"/>
            </graphic>
          </Button>
        </VBox>

        <!-- Spacer to ensure scroll content doesn't overlap with sticky footer -->
        <Region prefHeight="80"/>
      </VBox>
    </ScrollPane>
  </center>

  <!-- Sticky Action Footer -->
  <bottom>
    <VBox styleClass="sticky-footer" spacing="12">
      <Button onAction="#handleSave" text="Save Changes" styleClass="cta-primary-full">
        <graphic>
          <FontIcon iconLiteral="mdi2c-content-save-outline" iconSize="20" iconColor="white"/>
        </graphic>
      </Button>
      <Button onAction="#handleCancel" text="Cancel" styleClass="button-ghost-full"/>
    </VBox>
  </bottom>
</BorderPane>
